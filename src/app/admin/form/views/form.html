
	<div class="row">
	    <div class="col-lg-12">
	        <h1 class="page-header">Form</h1>
	    </div>
	</div>

	<div class="row">
		<div class="col-lg-6">
	    	<div class="panel panel-default">
	            <div class="panel-heading clearfix">
	            	<div class="panel-title pull-left">
	            		<h4>Formulir</h4>
	            	</div>
	            </div>

             	<div class="panel-body">
	                <div class="row">
	                	<div class="col-lg-12">
	                		<form name="FormForm" role="form" enctype="multipart/form-data">
								<!-- ng class untuk validasi form input -->
	                			<div class="form-group has-feedback"
	                				ng-class="{
	                					'has-error': FormForm.standard_id.$invalid && FormForm.standard_id.$dirty && 
	                						!vm.loadingStandard }">
									<!-- Label -->
                                    <label class="control-label">Standar</label>&nbsp;<label style="color: #a94442;">*</label>
                                    <!-- Dropdown form control -->
									<select name="standard_id" class="form-control" 
                                    	ng-options="option.id as option.description for option in vm.standards" 
                                    	ng-model="vm.standard_id" ng-change="vm.selectStandard(vm.standard_id)" ng-required="true">
                                    </select>
									<!-- menampilkan icon silang jika invalid -->
                                    <span style="right: 10px;" class="form-control-feedback" 
  										ng-show="FormForm.standard_id.$dirty || vm.loadingStandard" aria-hidden="true">
  										<i class="fa" ng-class="{ 
  											'fa-close fa-lg': FormForm.standard_id.$invalid && FormForm.standard_id.$dirty && 
  												!vm.loadingStandard }"></i>
  									</span>
									<!-- Menampilkan icon spinner ketika data sedang ditarik dari database secara async -->
  									<span style="right: 10px;" ng-show="vm.loadingStandard" class="form-control-feedback" aria-hidden="true">
  										<i class="fa fa-spinner fa-pulse fa-lg"></i>
  									</span>
									<!-- Pesan ketika invalid -->
  									<div style="color: #a94442;" ng-messages="FormForm.standard_id.$error" 
  										ng-if="FormForm.standard_id.$dirty">
								        <small ng-message="required">* Standar harus ditentukan terlebih dahulu.</small>
								    </div>
									<!-- Pesan ketika loading -->
								    <small ng-show="loadingStandard">* Load nama standar</small>
                                </div>

                                <div class="form-group has-feedback"
	                				ng-class="{
	                					'has-error': FormForm.standard_document_id.$invalid && FormForm.standard_document_id.$dirty && 
	                						!vm.loadingStandardDocument && vm.hasStandard && vm.standard_id}">
                                    <label class="control-label">Dokumen Standard</label>&nbsp;<label style="color: #a94442;">*</label>
                                    <select name="standard_document_id" class="form-control" 
                                    	ng-options="option.id as option.no + ' ' + option.description for option in vm.standardDocuments"  
                                    	ng-model="vm.standard_document_id" ng-change="vm.selectStandardDocument(vm.standard_document_id)" 
                                    	ng-disabled="!vm.standard_id || vm.loadingStandardDocument || !vm.hasStandard" ng-required="true">
                                    </select>
                                    <span style="right: 10px;" class="form-control-feedback" 
  										ng-show="FormForm.standard_document_id.$dirty || vm.loadingStandardDocument" aria-hidden="true">
  										<i class="fa" ng-class="{ 
  											'fa-close fa-lg': FormForm.standard_document_id.$invalid && FormForm.standard_document_id.$dirty 
  												&& !vm.loadingStandardDocument && vm.hasStandard && vm.standard_id }"></i>
  									</span>
  									<span style="right: 10px;" ng-show="vm.loadingStandardDocument" class="form-control-feedback" aria-hidden="true">
  										<i class="fa fa-spinner fa-pulse fa-lg"></i>
  									</span>
  									<div style="color: #a94442;" ng-messages="FormForm.standard_document_id.$error" 
  										ng-if="FormForm.standard_document_id.$dirty && vm.hasStandard && vm.standard_id">
								        <small ng-message="required">* Standar harus ditentukan terlebih dahulu.</small>
								    </div>
								    <small ng-show="vm.loadingStandardDocument">* Load nama Standar Document</small>
								    <small ng-show="!vm.hasStandard && !vm.loadingStandardDocument">* Standar ini belum memiliki Dokumen Standar. harap buat Dokumen Standar terlebih dahulu</small>
                                </div>

	                			<div class="form-group has-feedback"
	                				ng-class="{
	                					'has-error': FormForm.guide_id.$invalid && FormForm.guide_id.$dirty && !vm.loadingGuide && vm.hasStandard && 
	                						vm.hasStandardDocument && vm.standard_document_id }">
                                    <label class="control-label">Pedoman Mutu</label>&nbsp;<label style="color: #a94442;">*</label>
                                    <select name="guide_id" class="form-control" ng-options="option.id as option.no + ' ' + option.description for option in vm.guides"  
                                    	ng-model="vm.guide_id" ng-change="vm.selectGuide(vm.guide_id)"  ng-required="true"
                                    	ng-disabled="!vm.standard_id || !vm.standard_document_id || vm.loadingStandardDocument || !vm.hasStandard || !vm.hasStandardDocument" >
                                    </select>
                                    <span style="right: 10px;" class="form-control-feedback" 
  										ng-show="FormForm.guide_id.$dirty || vm.loadingGuide" aria-hidden="true">
  										<i class="fa" ng-class="{ 
  											'fa-close fa-lg': FormForm.guide_id.$invalid && FormForm.guide_id.$dirty && !vm.loadingGuide && 
  												vm.hasStandard && vm.hasStandardDocument && vm.standard_document_id}"></i>
  									</span>
  									<span style="right: 10px;" ng-show="vm.loadingGuide" class="form-control-feedback" aria-hidden="true">
  										<i class="fa fa-spinner fa-pulse fa-lg"></i>
  									</span>
  									<div style="color: #a94442;" ng-messages="FormForm.guide_id.$error" 
  										ng-if="FormForm.guide_id.$dirty && vm.hasStandard && vm.hasStandardDocument && vm.standard_document_id">
								        <small ng-message="required">* Pedoman Mutu harus ditentukan terlebih dahulu.</small>
								    </div>
								    <small ng-show="vm.loadingGuide">* Load nama Standar Document</small>
								    <small ng-show="!vm.hasStandardDocument && !vm.loadingGuide && vm.standard_id && vm.standard_document_id">* Pedoman Mutu ini belum memiliki Dokumen Standar. harap buat Dokumen Standar terlebih dahulu</small>
                                </div>

                                <div class="form-group has-feedback"
	                				ng-class="{
	                					'has-error': FormForm.instruction_id.$invalid && FormForm.instruction_id.$dirty && !vm.loadingInstruction && vm.hasStandard && 
	                						vm.hasStandardDocument && vm.hasGuide && vm.guide_id }">
                                    <label class="control-label">Instruksi Kerja (SOP)</label>&nbsp;<label style="color: #a94442;">*</label>
                                    <select name="instruction_id" class="form-control" ng-options="option.id as option.no + ' ' + option.description for option in vm.instructions"  
                                    	ng-disabled="!vm.standard_id || !vm.standard_document_id || !vm.guide_id || vm.loadingStandardDocument || !vm.hasStandard || !vm.hasStandardDocument || !vm.hasGuide"
                                    	ng-model="vm.input.instruction_id" ng-required="true">
                                    </select>
                                    <span style="right: 10px;" class="form-control-feedback" 
  										ng-show="FormForm.instruction_id.$dirty || vm.loadingInstruction" aria-hidden="true">
  										<i class="fa" ng-class="{ 
  											'fa-close fa-lg': FormForm.instruction_id.$invalid && FormForm.instruction_id.$dirty && !vm.loadingInstruction && vm.hasStandard && 
	                						vm.hasStandardDocument && vm.hasGuide && vm.guide_id }"></i>
  									</span>
  									<span style="right: 10px;" ng-show="vm.loadingInstruction" class="form-control-feedback" aria-hidden="true">
  										<i class="fa fa-spinner fa-pulse fa-lg"></i>
  									</span>
  									<div style="color: #a94442;" ng-messages="FormForm.instruction_id.$error" 
  										ng-if="FormForm.instruction_id.$dirty && vm.hasStandard && vm.hasStandardDocument && vm.hasGuide && vm.guide_id">
								        <small ng-message="required">* Pedoman Mutu harus ditentukan terlebih dahulu.</small>
								    </div>
								    <small ng-show="vm.loadingInstruction">* Load nama Standar Document</small>
								    <small ng-show="!vm.hasGuide && !vm.loadingInstruction && vm.standard_id && vm.standard_document_id && vm.guide_id">* Pedoman Mutu ini belum memiliki Dokumen Standar. harap buat Dokumen Standar terlebih dahulu</small>
                                </div>

	                			<div class="form-group has-feedback"
	                				ng-class="{
	                					'has-error': (vm.existNo && !vm.loadingNo) || FormForm.no.$invalid && FormForm.no.$dirty && vm.input.instruction_id,
	                					'has-success': !vm.existNo && FormForm.no.$valid && FormForm.no.$dirty && !vm.loadingNo }">
	                				<label class="control-label">Nomor Formulir</label>&nbsp;<label style="color: #a94442;">*</label>
	                				<input type="text" name="no" class="form-control"
	                					ng-model="vm.input.no" ng-required="true" ng-pattern="/^[a-zA-Z0-9(),.& -/]+$/" 
	                					ng-disabled="!vm.hasGuide || !vm.input.instruction_id">
	                				<span class="form-control-feedback" 
  										ng-show="FormForm.no.$dirty || vm.loadingNo" aria-hidden="true">
  										<i class="fa" ng-class="{ 
  											'fa-close fa-lg': vm.existNo || FormForm.no.$invalid && vm.input.instruction_id,
  											'fa-spinner fa-pulse fa-lg': vm.loadingNo && FormForm.no.$valid,
  											'fa-check fa-lg': !vm.existNo && FormForm.no.$valid && !vm.loadingNo }"></i>
  									</span>
  									<div style="color: #a94442;" ng-messages="FormForm.no.$error " 
  										ng-if="FormForm.no.$dirty && vm.input.instruction_id">
								        <small ng-message="required">* Nomor Formulir harus ditentukan terlebih dahulu.</small>
								        <small ng-message="pattern">* Nomor Formulir harus tidak boleh terdapat karaker spesial.</small>
								    </div>
								    <small ng-show="vm.loadingNo && FormForm.no.$valid">* Check Nomor Dokumen Pedoman Mutu</small>
								    <small style="color: #a94442;" ng-show="vm.existNo && FormForm.no.$valid && FormForm.no.$dirty && !vm.loadingNo ">
								    	* Nomor Formulir ini sudah ada didalam database.
							    	</small>
	                			</div>


                                <div class="form-group has-feedback"
	                				ng-class="{
	                					'has-error': FormForm.date.$invalid && FormForm.date.$dirty && vm.input.instruction_id}">
	                				<label class="control-label">Tanggal Form</label>&nbsp;<label style="color: #a94442;">*</label>
	                				<p class="input-group">
              							<input type="date" name="date" class="form-control" datepicker-popup datepicker-options="vm.dateOptions" 
              								ng-model="vm.input.date" is-open="vm.status.opened" ng-required="true" ng-disabled="!vm.hasGuide || !vm.input.instruction_id" close-text="Close" />
              							<span class="input-group-btn">
                							<button type="button" class="btn btn-default" ng-click="vm.open($event)" ng-disabled="!vm.hasGuide || !vm.input.instruction_id">
                								<i class="glyphicon glyphicon-calendar"></i>
                							</button>
              							</span>
            						</p>
            						<span style="right: 40px;" class="form-control-feedback" 
  										ng-show="FormForm.date.$dirty" aria-hidden="true">
  										<i class="fa" ng-class="{ 
  											'fa-close fa-lg': FormForm.date.$invalid && vm.input.instruction_id}"></i>
  									</span>
  									<div style="color: #a94442;" ng-messages="FormForm.date.$error " 
  										ng-if="FormForm.date.$dirty && vm.input.instruction_id">
								        <small ng-message="required">* Tanggal Form harus ditentukan terlebih dahulu.</small>
								    </div>
	                			</div>

	                			<div class="form-group has-feedback"
	                				ng-class="{
	                					'has-error': vm.existDescription || FormForm.description.$invalid && FormForm.description.$dirty && 
	                						!vm.loadingDescription && vm.input.instruction_id,
	                					'has-success': !vm.existDescription && FormForm.no.$valid && FormForm.description.$dirty && 
	                						!vm.loadingDescription }">
	                				<label class="control-label">Nama Form</label>&nbsp;<label style="color: #a94442;">*</label>
	                				<input type="text" name="description" class="form-control" 
	                					ng-model="vm.input.description" ng-required="true" ng-pattern="/^[a-zA-Z0-9(),.& -/]+$/" 
	                					ng-disabled="!vm.hasGuide || !vm.input.instruction_id">
	                				<span class="form-control-feedback" 
  										ng-show="FormForm.description.$dirty || vm.loadingDescription" aria-hidden="true">
  										<i class="fa" ng-class="{ 
  											'fa-close fa-lg': vm.existDescription || FormForm.description.$invalid && vm.input.instruction_id,
  											'fa-spinner fa-pulse fa-lg': vm.loadingDescription && FormForm.description.$valid,
  											'fa-check fa-lg': !vm.existDescription && FormForm.description.$valid && !vm.loadingDescription }"></i>
  									</span>
  									<div style="color: #a94442;" ng-messages="FormForm.description.$error " 
  										ng-if="FormForm.description.$dirty && vm.input.instruction_id">
								        <small ng-message="required">* Nama Form harus ditentukan terlebih dahulu.</small>
								        <small ng-message="pattern">* Nama Form harus tidak boleh terdapat karaker spesial.</small>
								    </div>
								    <small ng-show="vm.loadingDescription && FormForm.description.$valid">* Check Nama Dokumen Pedoman Mutu</small>
								    <small style="color: #a94442;" ng-show="vm.existDescription && FormForm.description.$dirty && !vm.loadingDescription ">
								    	* Nama Form ini sudah ada didalam database.
							    	</small>
	                			</div>

	                			<div class="form-group has-feedback"
	                				ng-class="{
	                					'has-error': FormForm.file.$invalid && FormForm.file.$dirty && vm.input.instruction_id }">
	                				<label class="control-label">File Instruksi Kerja (SOP)</label>&nbsp;<label style="color: #a94442;">*</label>
	                				<input type="file" name="file" class="form-control" ngf-select ngf-max-size="{{ $root.UPLOAD_MAX_SIZE }}" accept="{{ $root.FILE_TYPE }}" 
	                					ng-model="vm.input.file" ng-required="vm.requiredUpload" ng-disabled="!vm.hasGuide || !vm.input.instruction_id" 
                                        ngf-pattern="{{ $root.FILE_TYPE }}">
	                				<span class="form-control-feedback" 
  										ng-show="FormForm.file.$dirty" aria-hidden="true">
  										<i class="fa" ng-class="{ 
  											'fa-close fa-lg': FormForm.file.$invalid && vm.input.instruction_id,
  											'fa-check fa-lg': FormForm.file.$valid }"></i>
  									</span>
  									<div style="color: #a94442;" ng-messages="FormForm.file.$error " 
  										ng-if="FormForm.file.$dirty && vm.input.instruction_id">
								        <small ng-message="required">* Document terkait harus dilampirkan.</small>
                                        <small ng-message="pattern">* File yang hendak diupload tidak sesuai dengan format extensi yang diperbolehkan ({{ $root.FILE_TYPE }}).</small>
                                        <small ng-message="maxSize">* File melebihi batas maximal untuk diupload ({{ $root.UPLOAD_MAX_SIZE }}).</small>
								    </div>
								    <small ng-if="!vm.requiredUpload && vm.input.document"><a target="_blank" ng-href="{{ $root.FILE_HOST }}/upload/form/{{ vm.input.document }}">* {{ vm.input.document }}</a></small>
	                			</div>

	                		</form>
	                	</div>
	                </div>
	            </div>

	            <div class="panel-footer clearfix">
	                <div class="panel-title pull-right">
	                	<div class="form-inline">
		                	<a ui-sref="main.admin.form" class="btn btn-default"><i class="fa fa-undo"></i></a>
		                	<button ng-click="vm.submit()" class="btn btn-primary"
		                		ng-disabled="(FormForm.$invalid && vm.validated) || vm.existNo || vm.existDescription || vm.loadingNo || vm.loadingDescription">
		                		<i class="fa fa-save"></i>
		                	</button>
		                </div>
	                </div>
	            </div>

	        </div>
	   	</div>
	</div>

<json-formatter ng-if="$root.APP_DEBUG" json="vm.input" open="1"></json-formatter>
